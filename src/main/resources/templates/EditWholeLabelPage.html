<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
    <title>Title</title>
    <!--    <link href="./css/wholeLabelPageCSS.css" rel="stylesheet">-->
    <style>
        .sidebar {
            position: absolute;
            top: 140px;
            right: 0;
            min-height: 85%;
            background: #f6f6f6;
            width: 300px;
            font-family: "Microsoft YaHei UI";
            font-size: 20px;
        }

        .content {
            position: absolute;
            left: 300px;
            top: 160px;
            z-index: -1;
            width:1000px;
            height:600px;
            align-items: center;
            text-align: center;
        }


        body {
            background: white;
            background-size: cover;
            background-attachment:fixed;
            background-position: center center;
            background-repeat: no-repeat;
        }


        .right_box{
            background: #fff;
            box-shadow: 0 1px 6px 0 rgba(0, 0, 0, .12), 0 1px 6px 0 rgba(0, 0, 0, .12);
            border-radius: 3px;
            height: 250px;
            border-top: 1px solid #2093ff;
            width: 96%;
            margin-left: 2%;
            display: inline-block;
            float: top;
            vertical-align: top;
            margin-top: 10px;
        }

        hr{height:1px;border:none;border-top:1px solid lightgrey;}

        input{
            font-family: SimSun-ExtB;
        }

        .tag{
            background-color: lightyellow;
            font-size: 18px;
            border-radius: 5px;
            margin-top:5px ;
            width:250px;
            text-align: center;
            margin-left: 20px;
        }

    </style>

    <script>
        var tID;
        var order=localStorage.order;
        var picIDs= JSON.parse(localStorage.getItem('picIDs'));
        var picSrcs=JSON.parse(localStorage.getItem('picSrcs'));
        var picNum=picIDs.length;
        var workerAccount;

        function previousPic(){
            if(order==0){
                alert("已是第一张图片！");
            }else{
                order--;
                var picID=picIDs[order];
                document.getElementById("picture").src=picSrcs[order];
                document.getElementById("picID").value=picIDs[order];
                var obj=new Object();
                obj.workerAccount=workerAccount;
                obj.picID=picID;

                var html = $.ajax({
                    type: "Post",
                    url: '/editLabel/wholeLabel',
                    dataType:'json',
                    contentType: "application/json",
                    async: true,
                    data: JSON.stringify(obj),
                    success: function(myobj) {
                        loadLabel(myobj.wl,myobj.id);
                    },
                    error: function() {
                        alert("error");
                    }
                });
            }

        }

        function nextPic() {
            if (order == picNum - 1) {
                alert("已是第一张图片！");
            } else {
                order--;
                var picID = picIDs[order];
                document.getElementById("picture").src = picSrcs[order];
                document.getElementById("picID").value = picIDs[order];
                var obj = new Object();
                obj.workerAccount = workerAccount;
                obj.picID = picID;

                var html = $.ajax({
                    type: "Post",
                    url: '/editLabel/wholeLabel',
                    dataType: 'json',
                    contentType: "application/json",
                    async: true,
                    data: JSON.stringify(obj),
                    success: function (myobj) {
                        loadLabel(myobj.wl,myobj.id);
                    },
                    error: function () {
                        alert("error");
                    }
                });
            }
        }

        function myFunction(){

            var data = window.opener['filter'];
            var picSrc = data['picSrc'];
            document.getElementById("picture").src=picSrc;
            document.getElementById("picID").value=data['picID'];
            var picID=data['picID'];
            document.getElementById('demand').value=data['demand'];
            document.getElementById('category').innerText="分类："+data['category'];
            showTags();
            tID=window.opener['filter']['TaskID'];



            var obj=new Object();
            obj.workerAccount=localStorage.account;
            obj.picID=picID;

            var html = $.ajax({
                type: "Post",
                url: '/editLabel/wholeLabel',
                dataType:'json',
                contentType: "application/json",
                async: true,
                data: JSON.stringify(obj),
                success: function(myobj) {
                    loadLabel(myobj.wl,myobj.id);
                },
                error: function() {
                    alert("error");
                }
            });
        }

        function modify() {
            var gnl = confirm("确定修改?");
            if(gnl==true){
                var wholeLabel=new Object();
                wholeLabel.info=document.getElementById("label").value;
                var description={'c':document.getElementById("description").value};
                wholeLabel.d=description;
                wholeLabel.pID=document.getElementById("picID").value;
                wholeLabel.id=document.getElementById("labelID").value;
                wholeLabel.TaskID=tID;




                var html = $.ajax({
                    type: "Post",
                    url: '/editLabel/modifyWholeLabel',
                    dataType:'json',
                    contentType: "application/json",
                    async: false,
                    data: JSON.stringify(wholeLabel),
                    success: function(data) {
                        if(data==true){alert("修改成功")}

                    },
                    error: function() {
                        alert("error");
                    }
                });
            }
        }

        function  deleteLabel(){
            var gnl = confirm("确定删除?");
            if(gnl==true){
                var wholeLabel=new Object();
                wholeLabel.labelID=document.getElementById("labelID").value;
                wholeLabel.TaskID=tID;

                document.getElementById('demand').value=data['demand'];
                document.getElementById('category').innerText="分类："+data['category'];
                var html = $.ajax({
                    type: "Post",
                    url: '/editLabel/deleteLabel',
                    dataType:'json',
                    contentType: "application/json",
                    async: false,
                    data: JSON.stringify(wholeLabel),
                    success: function(data) {
                        if(data==true){
                            alert("success");
                            window.opener.location.reload();
                            window.close();
                        }

                    },
                    error: function() {
                        alert("error");
                    }
                });
            }
        }


        function loadLabel(obj,id){
            document.getElementById("label").value=obj.info;
            document.getElementById("description").value=obj.d.c;
            document.getElementById("labelID").value=id;
        }

        function showTags() {
            var tags=JSON.parse(localStorage.getItem('taskTags'));
            alert(tags.length);
            var i;
            for(i=0;i<tags.length;i++){
                var tag=document.createElement('div');
                tag.className='tag';
                tag.innerText=tags[i];
                document.getElementById('taskInfo').appendChild(tag);
            }
            if(tags.length==1){
                document.getElementById('taskInfo').style.height="285px";
            }else if(tags.length==2){
                document.getElementById('taskInfo').style.height="310px";
            }else if(tags.length==3){
                document.getElementById('taskInfo').style.height="335px";
            }
        }

        function close1() {
            window.opener=null;
            window.open('','_self');
            window.close();
        }


    </script>
</head>
<body onload="myFunction()">

<div id="userbar" style="position: fixed;width: 1860px;z-index: 3;padding-left: 20px;top:0;float:top;z-index: 4">
    <img src="../static/pic/logo.png" style="height: 60px;margin-left: -1%;max-width: 300px">
    <p style="font-family: 'Microsoft YaHei UI Light';font-size: 36px;color: white;display: inline-block;vertical-align:20%;margin-top: -6px;margin-left: 700px;">编辑整体标注</p>
    <div style="color: white;font-size: 25px;font-family: 'Microsoft YaHei UI';right:0;z-index: 4;position: fixed;display: inline-block;vertical-align: 40%">
        <p id="laber" style="display: inline-block;margin-right: 50px">标注者:Starink    </p>
        <a onclick="close1()" style="display: inline-block;cursor: pointer">返回目录</a>
    </div>

</div>

<div style="position: fixed;width: 101%;height:80px;background-color: skyblue;opacity: 1;z-index: 3;margin-top: -1%;margin-left: -1%"></div>
<br>

<div class="sidebar" style="margin-top: -70px;position: fixed">
    <div class="right_box" id="taskInfo">
        <p style="padding-left: 5px">任务信息</p>
        <hr style="margin-top: -2%">
        <p id="category" style="padding-left: 20px;margin-top: -5px">类别：动物</p>
        <p style="padding-left: 20px;margin-top: -5px">要求：</p>
        <textarea id="demand" style="text-align: left; font-size:19px; width:86%;height: 80px;margin-top:-10px; margin-left: 20px;" name="demand" readonly="readonly">无</textarea>
    </div>

    <div class="right_box" style="height: 340px">
        <p style="padding-left: 5px">标注详情：</p>
        <hr style="margin-top: -2%">
        <p style="padding-left: 20px;margin-top: -5px">标注：</p>
        <input type="text" id="label" style="height:30px;font-family: SimSun-ExtB;font-size:20px;margin-left: 20px;width: 86%;margin-top:-100px" value="苟利">
        <p style="padding-left: 20px;">描述：</p>
        <textarea id="description" style="text-align: left; font-size:19px; width:86%;height: 100px;margin-top:-10px; margin-left: 20px;" name="description">无</textarea>
    </div>

    <input id="picID"   style="display: none" name="picID"></input>
    <input id="flag"   style="display: none" name="flag" value=0></input>
    <input id="labelID"   style="display: none" name="labelID"></input>
    <button onclick="modify()" style=" font-family: 'Microsoft YaHei UI';font-size:20px; width:100px; margin-top: 20px; margin-left: 30px; color: black; background-color: white;height: 36px;">保存修改</button>
    <button onclick="deleteLabel()" style=" font-family: 'Microsoft YaHei UI';font-size:20px; width:100px; margin-top: 20px; margin-left: 30px; color: black; background-color: white;height: 36px;">删除标注</button>
</div>
<div class="content">
    <img id="picture" src="../static/pic/homepageBackground.jpg" style="max-height: 600px; max-width: 900px;min-height: 580px;">
</div>

<img src="../static/pic/leftArrow.png" style="left: 20px;top: 360px;position: fixed;max-width: 100px" onclick="previousPic()">
<img src="../static/pic/rightArrow.png" style="right:320px;top: 360px;position: fixed;max-width: 100px" onclick="nextPic()">

<div style="width:100%; bottom:0px; background-color: skyblue;margin-left: -0.2%;position: fixed;">
    <img src="../static/pic/logo.png" style="width:8%">
    <span style="color: white;text-align: center;font-size: 25px;vertical-align: center">让世界的智慧凝聚为你的眼</span>
    <span style="color: white;text-align: center;font-size: 25px;float: right;padding-top: 20px;margin-right: 0.4%">怎么码都码不队</span>
</div>

</body>
</html>